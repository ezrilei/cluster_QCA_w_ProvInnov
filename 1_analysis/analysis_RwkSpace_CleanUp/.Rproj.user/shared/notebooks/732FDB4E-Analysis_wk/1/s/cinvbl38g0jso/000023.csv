"0","plot_PIMS_patch <- function(Region_Target) {"
"0","  "
"0","  # 加载包"
"0","  library(dplyr)"
"0","  library(tidyr)"
"0","  library(ggplot2)"
"0","  library(stringr)"
"0","  # devtools::install_github(""ricardo-bion/ggradar"")"
"0","  library(ggradar)"
"0","  library(scales)"
"0","  library(showtext)"
"0","  library(patchwork)"
"0","  "
"0","  # 设定地区名称（你只需要改这行）"
"0","  region_target <- Region_Target"
"0","  "
"0","  # 筛选该地区的所有案例（如 湖北_2016、湖北_2017）"
"0","  df_pims_region <- df_PIMS %>%"
"0","    filter(stringr::str_detect(CASE, region_target)) %>%"
"0","    mutate(YEAR = as.integer(stringr::str_extract(CASE, ""\\d{4}"")))  # 提取年份"
"0","  "
"0","  # 数据转换为长格式（路径做变量，方便 ggplot）"
"0","  df_pims_region_long <- df_pims_region %>%"
"0","    pivot_longer(cols = -c(CASE, YEAR),"
"0","                 names_to = ""CONFIG"","
"0","                 values_to = ""PIMS"")"
"0","  "
"0","  df_pims_region_long <- df_pims_region_long %>%"
"0","    mutate("
"0","      PATHWAY = case_when("
"0","        CONFIG == ""X1*X3*X4*X5*X7*X8*X9→Y"" ~ ""路径1a"","
"0","        CONFIG == ""X1*X4*X5*X6*X7*X8*X9→Y"" ~ ""路径1b"","
"0","        CONFIG == ""X1*X2*X3*X4*X5*~X6*X7*X8→Y"" ~ ""路径2"","
"0","        CONFIG == ""~X1*~X3*~X4*~X5*~X7*~X8*~X9→~Y"" ~ ""路径3"""
"0","      )"
"0","    )"
"0","  "
"0","  "
"0","  # 绘图 ----"
"0","  "
"0","  # show CN text"
"0","  # library(showtext) #https://github.com/yixuan/showtext"
"0","  showtext_auto(enable = TRUE)"
"0","  font_add(""SongTi"", regular = ""./fonts/ STSongti-Regular-SC.ttf"")# <<<<<<<<<<<<<<"
"0","  "
"0","  # text repel data"
"0","  label_data <- df_pims_region_long %>%"
"0","    group_by(PATHWAY) %>%"
"0","    filter(YEAR == max(YEAR)) %>%"
"0","    ungroup()"
"0","  "
"0","  "
"0","  ## plot line -----"
"0",""
"0","  # 绘图：路径随时间变化图（每条路径一条线） ----"
"0","  "
"0","  p_case_pims <-"
"0","    ggplot(df_pims_region_long, aes(x = YEAR, y = PIMS, color = PATHWAY)) +"
"0","    geom_line() +"
"0","    geom_point() +"
"0","    geom_hline(yintercept = 0.5,"
"0","               linetype = ""dashed"","
"0","               color = ""gray50"") +"
"0","    scale_y_continuous(limits = c(0, 1)) +"
"0","    scale_x_continuous(breaks = sort(unique(df_pims_region_long$YEAR))) +"
"0","    labs("
"0","      title = paste0(""路径隶属度演化"", ""（"", region_target, ""）""),"
"0","      #subtitle = ""每条线代表一个路径组态的 fuzzy membership 值"","
"0","      x = ""年份"","
"0","      y = ""模糊集隶属度得分"","
"0","      color = ""因果路径"""
"0","    ) +"
"0","    "
"0","    theme_bw(base_family = ""SongTi"") +"
"0","    theme("
"0","      text = element_text(family = ""SongTi""),"
"0","      plot.title = element_text(family = ""SongTi"", size = 18),"
"0","      axis.title = element_text(family = ""SongTi"", size = 14),"
"0","      legend.title = element_text(family = ""SongTi"", size = 12),"
"0","      # 图例标题"
"0","      legend.text = element_text(family = ""SongTi"", size = 10),"
"0","      # 图例标签"
"0","      legend.position = ""bottom"","
"0","      plot.margin = unit(c(1, 4, 1, 1), ""cm"")"
"0","    ) +"
"0","    # guides("
"0","    #   color = guide_legend(ncol = 1)"
"0","    #   #linetype = guide_legend(ncol = 1)"
"0","    #   #linetype = guide_legend(override.aes = list(color = ""black""))"
"0","    # )"
"0","    # 添加标签：在最后一年（如 2023）右侧略微偏移"
"0","    geom_text_repel("
"0","      family = ""SongTi"","
"0","      data = label_data,"
"0","      aes(label = PATHWAY),"
"0","      nudge_x = 0.5,"
"0","      # 向右偏移"
"0","      direction = ""both"","
"0","      # 允许上下左右避让"
"0","      hjust = 0,"
"0","      # 左对齐"
"0","      segment.color = NA,"
"0","      # 不显示连接线"
"0","      size = 3.0,"
"0","      box.padding = 0.3,"
"0","      point.padding = 0.05,"
"0","      force = 4,"
"0","      # 排斥强度（更强避让）"
"0","      force_pull = 0.2,"
"0","      # 吸引力增强，靠近线尾"
"0","      max.overlaps = Inf,"
"0","      show.legend = FALSE        # 不用其出现在图例，"
"0","      # 如果不告诉其如何显示图例，会在图例处每一个config前 加默认图例项 ""a"""
"0","    )"
"0","  "
"0","  ## plot radar -----"
"0","  "
"0","  df_radar <- df_pims_region_long %>%"
"0","    group_by(PATHWAY, YEAR) %>%"
"0","    summarise(PIMS = mean(PIMS, na.rm = TRUE), .groups = ""drop"") %>%"
"0","    pivot_wider(names_from = YEAR, values_from = PIMS)"
"0","  "
"0","  df_radar[is.na(df_radar)] <- 0  # 可选处理缺失值"
"0","  "
"0","  # 绘图"
"0","  p_case_pims_radar <- ggradar("
"0","    df_radar,"
"0","    "
"0","    font.radar = ""SongTi"","
"0","    "
"0","    # The labels of the grid"
"0","    values.radar = c(""0"", ""0.5"", ""1""),"
"0","    grid.min = 0,"
"0","    grid.mid = 0.5,"
"0","    grid.max = 1,"
"0","    group.line.width = 0.5,"
"0","    group.point.size = 2,"
"0","    axis.label.size = 5,"
"0","    "
"0","    "
"0","    background.circle.colour = ""white"","
"0","    axis.line.colour = ""gray60"","
"0","    gridline.min.colour = ""gray60"","
"0","    gridline.mid.colour = ""gray60"","
"0","    gridline.max.colour = ""gray60"","
"0","    group.colours = c(""#f8766d"", ""#7cae00"", ""#00bfc4"", ""#c77cff""),"
"0","    "
"0","    legend.position = ""bottom"","
"0","    legend.text.size = 10,"
"0","    "
"0","    fill = TRUE,"
"0","    fill.alpha = 0.075,"
"0","    "
"0","    plot.title = paste0(""路径隶属度演化（"", region_target, ""）"")"
"0","  ) +"
"0","    "
"0","    #theme_bw(base_family = ""TimesNewRoman"") +"
"0","    theme("
"0","      text = element_text(family = ""SongTi""),"
"0","      axis.title = element_text(family = ""SongTi"", size = 14),"
"0","      legend.title = element_text(family = ""SongTi"", size = 12),"
"0","      # 图例标题"
"0","      legend.text = element_text(family = ""SongTi"", size = 10),"
"0","      # 图例标签"
"0","      legend.position = ""none"", # 不显示 legend"
"0","      plot.title = element_blank() # 不显示 plot title"
"0","    )"
"0","  "
"0","  # patch -----"
"0","  "
"0","  # library(patchwork)"
"0","  "
"0","  # 移除 plot.margin"
"0","  p1 <- p_case_pims + theme(plot.margin = unit(c(0, 0, 0, 0), ""cm""))"
"0","  p2 <- p_case_pims_radar + theme(plot.margin = unit(c(0, 0, 0, 0), ""cm""))"
"0","  "
"0","  # 输出到 PDF 文件"
"0",""
"0","  pdf(file = paste0(""./output/【Analysis_wk】3.充分性分析_路径模糊集隶属度_patch（"", "
"0","                    region_target, "
"0","                    ""）.pdf""),"
"0","      width = 14.5,"
"0","      height = 7)"
"0","  "
"0","  print("
"0","    (p1 | p2) +"
"0","    plot_layout(ncol = 2,"
"0","                widths = c(1, 1), "
"0","                guides = ""keep"") &"
"0","    theme(legend.position = ""bottom"")"
"0","  )"
"0","  "
"0",""
"0","  dev.off()"
"0","  "
"0","  "
"0","  "
"0","}"
"0",""
"0",""
